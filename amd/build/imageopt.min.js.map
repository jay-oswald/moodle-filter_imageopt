{"version":3,"sources":["../src/imageopt.js"],"names":["define","$","init","loadOptimisedImg","el","imgurl","attr","removeAttr","addClass","on","removeClass","document","ready","body","e","appeared","each","data","appear","appeartopoffset","appearleftoffset","force_appear","lastHash","location","hash","window","newHash","setTimeout"],"mappings":"AAwBAA,OAAM,4BAAC,CAAC,wBAAD,CAAD,CACF,SAASC,CAAT,CAAY,CACR,MAAO,CACHC,IAAI,CAAE,eAAW,CAQb,GAAIC,CAAAA,CAAgB,CAAG,SAASC,CAAT,CAAaC,CAAb,CAAqB,CACxCJ,CAAC,CAACG,CAAD,CAAD,CAAME,IAAN,CAAW,KAAX,CAAkBD,CAAlB,EACAJ,CAAC,CAACG,CAAD,CAAD,CAAMG,UAAN,CAAiB,oBAAjB,EACAN,CAAC,CAACG,CAAD,CAAD,CAAMI,QAAN,CAAe,kBAAf,EACAP,CAAC,CAACG,CAAD,CAAD,CAAMK,EAAN,CAAS,MAAT,CAAiB,UAAW,CACxBR,CAAC,CAACG,CAAD,CAAD,CAAMM,WAAN,CAAkB,kBAAlB,CACH,CAFD,CAGH,CAPD,CASAT,CAAC,CAACU,QAAD,CAAD,CAAYC,KAAZ,CAAkB,UAAW,CACzBX,CAAC,CAACU,QAAQ,CAACE,IAAV,CAAD,CAAiBJ,EAAjB,CAAoB,QAApB,CAA8B,yBAA9B,CAAyD,SAASK,CAAT,CAAYC,CAAZ,CAAsB,CAC3EA,CAAQ,CAACC,IAAT,CAAc,UAAW,CACrB,GAAIX,CAAAA,CAAM,CAAGJ,CAAC,CAAC,IAAD,CAAD,CAAQgB,IAAR,CAAa,eAAb,CAAb,CACAd,CAAgB,CAAC,IAAD,CAAOE,CAAP,CACnB,CAHD,CAIH,CALD,EAQAJ,CAAC,CAAC,yBAAD,CAAD,CAA6BiB,MAA7B,CADiB,CAACC,eAAe,CAAE,GAAlB,CAAuBC,gBAAgB,CAAE,GAAzC,CACjB,EACAnB,CAAC,CAACoB,YAAF,GAKA,CAAC,UAAW,CACR,GAAIC,CAAAA,CAAQ,CAAGC,QAAQ,CAACC,IAAxB,CACAvB,CAAC,CAACwB,MAAD,CAAD,CAAUhB,EAAV,CAAa,qBAAb,CAAoC,UAAW,CAC3C,GAAIiB,CAAAA,CAAO,CAAGH,QAAQ,CAACC,IAAvB,CACA,GAAIE,CAAO,GAAKJ,CAAhB,CAA0B,CACtBG,MAAM,CAACE,UAAP,CACI,UAAW,CACP1B,CAAC,CAACoB,YAAF,EACH,CAHL,CAII,GAJJ,CAMH,CACDC,CAAQ,CAAGI,CACd,CAXD,CAYH,CAdD,GAgBH,CA/BD,CAgCH,CAlDE,CAoDV,CAtDC,CAAN","sourcesContent":["/**\n * This file is part of Moodle - http://moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @package   filter_imgopt\n * @copyright Copyright (c) 2017 Guy Thomas\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Main initialising function.\n */\ndefine(['filter_imageopt/appear'],\n    function($) {\n        return {\n            init: function() {\n\n                /**\n                 * Load optimised image.\n                 * @param {Element} el\n                 * @param {string} imgurl\n                 * @returns {void}\n                 */\n                var loadOptimisedImg = function(el, imgurl) {\n                    $(el).attr('src', imgurl);\n                    $(el).removeAttr('data-loadonvisible');\n                    $(el).addClass('imageopt_loading');\n                    $(el).on('load', function() {\n                        $(el).removeClass('imageopt_loading');\n                    });\n                };\n\n                $(document).ready(function() {\n                    $(document.body).on('appear', 'img[data-loadonvisible]', function(e, appeared) {\n                        appeared.each(function() {\n                            var imgurl = $(this).data('loadonvisible');\n                            loadOptimisedImg(this, imgurl);\n                        });\n                    });\n                    // Appear configuration - start loading images when they are out of the view port by 400px.\n                    var appearConf = {appeartopoffset: 100, appearleftoffset: 100};\n                    $('img[data-loadonvisible]').appear(appearConf);\n                    $.force_appear();\n\n                    /**\n                     * Listen for hash changes / popstates.\n                     */\n                    (function() {\n                        var lastHash = location.hash;\n                        $(window).on('popstate hashchange', function() {\n                            var newHash = location.hash;\n                            if (newHash !== lastHash) {\n                                window.setTimeout(\n                                    function() {\n                                        $.force_appear();\n                                    },\n                                    200\n                                );\n                            }\n                            lastHash = newHash;\n                        });\n                    })();\n\n                });\n            }\n        };\n    }\n);\n"],"file":"imageopt.min.js"}